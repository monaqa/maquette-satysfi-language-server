# 実装メモ

## 実装したい機能

- [x] completion: コマンド名補完
- [ ] definition: コマンドの定義ジャンプ
- [ ] hover: primitive の情報表示
- [ ] import 先のファイル読み込み
- [ ] require 先のファイル読み込み
- [ ] completion: パッケージ名補完
- [ ] code action: add command definition to preamble
      （カーソル下のコマンドが未定義の場合、その定義をプリアンブルに追加）
- [ ] completion: 変数名補完
- [ ] definition: 変数の定義ジャンプ
- [ ] diagnostics: 文法エラー
- [ ] declaration: module の signature へジャンプ
- [ ] format
- [ ] rename: 変数やコマンド名の変更 **バッファ内容変更有**
- [ ] symbol: 定義済みコマンドの一覧を表示
- [ ] symbol: 定義済み変数の一覧を表示
- [ ] reference: 変数の reference 情報
- [ ] type hint: コマンドの後のシグネチャ情報（要型検査器）
- [ ] completion: コマンド名補完 + 後ろのシグニチャも同時に補完（要型検査器）
- [ ] completion: レコードのメンバ補完（要型検査器）
- [ ] diagnostics: エラー以外のlint（要型検査器？）
- [ ] type definition: その変数の型へのジャンプ（要型検査器）
- [ ] diagnostics: 型エラー（要型検査器）
- [ ] hover :型情報表示（要型検査器）

### Completaion

一口に補完といっても、様々なものが考えられる。

#### コマンド名補完

インラインコマンド、ブロックコマンド、数式コマンドの名前を補完。
`\` や `+` をトリガーとして動く。
現在のカーソル位置のモードに応じて表示するコマンドの種類を出し分ける。


#### 予約語・プリミティヴ補完

`let-inline` などのある程度様式が決まっている予約語及び
`read-inline` や `inline-nil` といったプリミティヴを補完。
カーソル位置がプログラムモードであるときに限って候補を出す。


#### 変数名補完

変数名を補完。プログラムモードでのみ動く。
スコープを考慮して変数名を制限できるようにする。

#### パッケージ名補完

`@require: ` 及び `@import: ` をトリガーとして、パッケージ名を補完。

#### モジュール名補完

#### 型名補完

基本型及びユーザ定義型。

#### レコードのメンバ補完

定義済みのレコードに対し、そのメンバ名を補完する。 `#` をトリガーとして起動。

### Definition

定義へジャンプ。

#### コマンド定義ジャンプ

#### 変数定義ジャンプ

#### モジュール定義ジャンプ

#### パッケージジャンプ

`@require:` や `@import:` のパッケージ名から、該当するパッケージに飛ぶ。
Vim では何も入れなくても `gf` でほぼ同じことができるので、正直あまり需要がない。

### Hover

カーソル位置の情報取得。

#### 変数の型

#### doc comment

SATySFi 自体に doc comment が未実装のため保留。

参考：[追加したい機能とそのイメージ/doc comment](https://github.com/gfngfn/SATySFi/wiki/%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%9F%E3%81%84%E6%A9%9F%E8%83%BD%E3%81%A8%E3%81%9D%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8#2020-03-22-doc-comment)


